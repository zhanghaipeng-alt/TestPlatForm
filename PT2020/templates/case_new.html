{% extends 'base.html' %}

{% block breadcrumb %}
<a href="">首页</a>
<a href="">接口管理</a>
<a href="">用例管理</a>
<a href=""><cite>用例单条新增</cite></a>
{% endblock %}

{% block content %}
{% if project is not None and api is not None%}
<span class="layui-badge layui-bg-green" style="font-size: 20px;">{{api.name}}</span>
<div class="layui-row" style="margin-top: 20px">
    <div class="layui-col-md7 layui-col-sm7">
    <h2 style="margin-bottom: 20px">接口参数</h2>
    <form class="layui-form layui-form-pane" method="post"> <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
      <div class="layui-form-item">
        <label class="layui-form-label">所属项目：</label>
        <div class="layui-input-block">
          <input type="text" name="pname" autocomplete="off" class="layui-input" value="{{ project.name }}" disabled="disabled">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">接口名称：</label>
        <div class="layui-input-block">
          <input lay-verify="required" type="text" name="name" autocomplete="off" class="layui-input" value="{{ api.name }}" disabled="disabled">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">描述：</label>
        <div class="layui-input-block">
          <input type="text" name="desc" autocomplete="off" class="layui-input" value="{{ api.desc }}" disabled="disabled">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">请求地址：</label>
        <div class="layui-input-block">
          <input lay-verify="required" type="text" name="url" autocomplete="off" class="layui-input" value="{{ api.url }}" disabled="disabled">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">方法类型：</label>
        <div class="layui-input-block">
          {% if api.method == 0 %}
          <input disabled type="radio" lay-filter="mradio" name="method" value="0" title="GET" checked>
          <input disabled type="radio" lay-filter="mradio" name="method" value="1" title="POST">
          {% elif api.method == 1 %}
          <input disabled type="radio" lay-filter="mradio" name="method" value="0" title="GET">
          <input disabled type="radio" lay-filter="mradio" name="method" value="1" title="POST" checked>
          {% endif %}
        </div>
      </div>

      <div class="layui-form-item body-type">
        <label class="layui-form-label">正文类型：</label>
        <div class="layui-input-block">
          {% if api.body_type == 0 %}
          <input disabled type="radio" lay-filter="term" name="body-type" value="0" title="NONE" checked>
          <input disabled type="radio" lay-filter="term" name="body-type" value="1" title="FORM">
          <input disabled type="radio" lay-filter="term" name="body-type" value="2" title="JSON">
          {% elif  api.body_type == 1 %}
          <input disabled type="radio" lay-filter="term" name="body-type" value="0" title="NONE">
          <input disabled type="radio" lay-filter="term" name="body-type" value="1" title="FORM" checked>
          <input disabled type="radio" lay-filter="term" name="body-type" value="2" title="JSON">
          {% elif  api.body_type == 2 %}
          <input disabled type="radio" lay-filter="term" name="body-type" value="0" title="NONE">
          <input disabled type="radio" lay-filter="term" name="body-type" value="1" title="FORM">
          <input disabled type="radio" lay-filter="term" name="body-type" value="2" title="JSON" checked>
          {% endif %}
        </div>
      </div>
    </form>
    </div>
</div>
<HR align=center width=1000 color=#d2d2d2 SIZE=2>
<div class="layui-row" style="margin-top: 20px">
    <div class="layui-col-md7 layui-col-sm7">
    <h2 style="margin-bottom: 20px">用例参数</h2>
    <form class="layui-form layui-form-pane" method="post"> <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
      <div class="layui-form-item">
        <label class="layui-form-label">用例名称：</label>
        <div class="layui-input-block">
          <input style="display: none" type="text" name="pid" value="{{ project.id }}" class="layui-input">
          <input style="display: none" type="text" name="aid" value="{{ api.id }}" class="layui-input">
          <input lay-verify="required" type="text" name="name" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">描述：</label>
        <div class="layui-input-block">
          <input type="text" name="desc" autocomplete="off" class="layui-input">
        </div>
      </div>
    {% if headers|length > 0 %}
    {% for key,value in headers.items %}
      {% if forloop.first %}
        <div class="layui-form-item header-first">
          <label class="layui-form-label add-header" style="cursor: pointer">请求头：</label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_key" placeholder="Key" value="{{ key }}" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_value" placeholder="Value" value="{{ value }}" autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>
      {% else %}
          <div class="layui-form-item">
          <label class="layui-form-label" style="text-align: left">
              <i class="layui-icon layui-icon-add-circle add-header" style="cursor:pointer; color: #5FB878;margin-left: 10px"></i>
              <i class="layui-icon layui-icon-reduce-circle delete-key-value" style="cursor:pointer;color: #FF5722;margin-left: 10px"></i>
          </label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_key" placeholder="Key" value="{{ key }}" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_value" placeholder="Value" value="{{ value }}" autocomplete="off" class="layui-input">
            </div>
          </div>
      </div>
      {% endif %}
      {% endfor %}
    {% else %}
        <div class="layui-form-item header-first">
          <label class="layui-form-label add-header" style="cursor: pointer">请求头：</label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_key" placeholder="Key" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_value" placeholder="Value" autocomplete="off" class="layui-input">
            </div>
          </div>
      </div>
    {% endif %}
      <div class="layui-form-item url-params">
          <label class="layui-form-label" style="cursor: pointer">URL参数：</label>
          <div class="layui-input-block">
            <textarea type="text" name="url-value" style="height: 200px;" class="layui-textarea">{{ api.query }}</textarea>
          </div>
      </div>
      <div class="layui-form-item body-params">
        <label class="layui-form-label">正文参数：</label>
        <div class="layui-input-block">
            <textarea type="text" name="body-value" style="height: 200px;" class="layui-textarea">{{ api.body }}</textarea>
        </div>
      </div>
      <div class="layui-form-item">
          <label class="layui-form-label" style="cursor: pointer">响应状态码</label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" lay-verify="number" name="status_code" value=200 autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>
      <div class="layui-form-item">
          <label class="layui-form-label" style="cursor: pointer">响应字段值</label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="check_path" placeholder="Json路径" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="check_value" placeholder="预期结果" autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>
      <div class="layui-form-item">
          <label class="layui-form-label" style="cursor: pointer">响应字段值</label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="check_path" placeholder="Json路径" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="check_value" placeholder="预期结果" autocomplete="off" class="layui-input">
            </div>
          </div>
        </div>
      <div class="layui-form-item" style="margin-top: 50px">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit lay-filter="*">立即提交</button>
          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
      </div>
    </form>
    <div style="display: none" class="header-input">
        <div class="layui-form-item">
          <label class="layui-form-label" style="text-align: left">
              <i class="layui-icon layui-icon-add-circle add-header" style="cursor:pointer; color: #5FB878;margin-left: 10px"></i>
              <i class="layui-icon layui-icon-reduce-circle delete-key-value" style="cursor:pointer;color: #FF5722;margin-left: 10px"></i>
          </label>
          <div class="layui-input-block">
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_key" placeholder="Key" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline" style="width: 47%;">
              <input type="text" name="header_value" placeholder="Value" autocomplete="off" class="layui-input">
            </div>
          </div>
      </div>
      </div>
    </div>
</div>

{% elif  project is None %}
<h2 style="color: #FF5722">项目信息不存在</h2>
{% elif  api is None %}
<h2 style="color: #FF5722">接口信息不存在</h2>

{% endif %}

{% endblock %}

{% block js %}

    $("form").on("click",".add-header", function(){
        $(".header-first").after($(".header-input").html());
    });

    $("form").on("click",".add-url-params", function(){
        $(".url-params").after($(".url-params-input").html());
    });

    $("form").on("click",".add-form-params", function(){
        $(".form-params").after($(".form-params-input").html());
    });

    $("form").on("click",".delete-key-value", function(){
        $(this).parent().parent().remove();
    });

    form.on('submit(*)', function(data){
      var formData = {};
      var t = $('form').serializeArray();
      $.post('/case/add/', t, function (result) {
        if (result.code == 0){
             layer.msg(result.msg, {time: 2000});
             setTimeout(function () { window.location.href="/case/list/?project={{ project.id }}"}, 2000);
        }else if(result.code == 1){
            layer.msg(result.msg, {time: 2000});
        }
      });
      return false;
    });
{% endblock %}
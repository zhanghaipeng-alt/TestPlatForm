{% extends 'base.html' %}

{% block breadcrumb %}
<a href="">首页</a>
<a href="">测试任务</a>
<a href=""><cite>新增测试任务</cite></a>
{% endblock %}


{% block content %}
<div class="layui-row">
    <div class="layui-col-md9 lay-col-sm9">
        <form class="layui-form layui-form-pane" action="" method="" id="Form">
            <div class="layui-form-item">
                <label class="layui-form-label">所属项目</label>
                <div class="layui-input-block">
                    <select name="pid" lay-verify="required" lay-filter="project">
                        <option selected="selected" value="0">选择项目</option>
                        {% for project in projects %}
                            <option value={{ project.id }}>{{project.name}}</option>
                        {% endfor %}
                    </select>
                </div>
              </div>

            <div class="layui-form-item">
                <label class="layui-form-label">任务名称</label>
                <div class="layui-input-block">
                    <input class="layui-input" type="text" name="name" required lay-verify="required" placeholder="最大长度为20" autocomplete="off">
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">任务描述</label>
                <div class="layui-input-block">
                    <input class="layui-input" name="desc" type="text" placeholder="最大长度30字符">
                </div>
            </div>


            <div class="layui-form-item">
                <fieldset class="layui-elem-field layui-field-title">
                  <legend style="font-size: 18px">选择用例</legend>
                </fieldset>
                <table class="layui-table" id="case_table" lay-filter="case_table"></table>
            </div>


            <div class="layui-form-item" style="margin-top: 50px">
                <div class="layui-input-block">
                  <button type="submit" class="layui-btn" lay-submit lay-filter="addCase">立即提交</button>
                  <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!--<script type="text/html" id="toolbarDemo">-->
<!--    <div class="layui-btn-container">-->
<!--        <span class="layui-btn layui-btn-sm" lay-event="getCheckData">选中数据</span>-->
<!--    </div>-->
<!--</script>-->



{% endblock %}

{% block js %}

      table.render({
        elem: '#case_table'
        ,url: '/api/case/get_caseinfo/'
<!--        ,toolbar: '#toolbarDemo'  //可以自定义一个工具栏-->
        ,title: '接口列表'
        ,page: true
        ,cols: [[
            {type: 'checkbox'}
           ,{field: 'id', title: '用例编号', width:120, sort: true}
          ,{field: 'name', title: '用例名称', width:280}
          ,{field: 'api_name', title: '所属接口', width:260}
          ,{field: 'update_time', title: '更新时间', width: 180}
        ]]
      });


<!--      table.on('toolbar(case-table)', function(obj){-->
<!--        var checkStatus = table.checkStatus(obj.config.id);-->
<!--        switch(obj.event){-->
<!--          case 'getCheckData':-->
<!--            var data = checkStatus.data;-->
<!--            layer.alert(JSON.stringify(data));-->
<!--          break;-->
<!--        };-->
<!--      });-->



        form.on('submit(addCase)', function(data){
            var cases = [];
            var checkStatus = table.checkStatus('case_table');
            for(var i in checkStatus.data){
                cases.push(checkStatus.data[i].id)
            }
            case_numbers = cases.join(",");

            $.post('/task/api/new/', {pid:data.field.pid, name:data.field.name, desc:data.field.desc, case_number:case_numbers}, function(result){
                if(result.code == 0){
                    layer.msg(result.msg, {time:2000}, function(){
                        window.location.href="/task/list/"
                    });
                }else if(result.code == 1){
                    layer.msg(result.msg, {time:2000});
                }
            });
            return false
        });

{% endblock%}